<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إدارة TEXAS STORE</title>
<style>
body {font-family:Poppins,sans-serif; background:#07122a; color:#fff; padding:20px;}
textarea {width:100%; height:400px; background:#0b0f1a; color:#fff; border:none; padding:10px;}
input, button {padding:8px; margin:4px;}
</style>
</head>
<body>
<h1>إدارة الأسعار</h1>
<p>عدل JSON ثم اضغط حفظ لتحديث الأسعار مباشرة على الموقع:</p>
<textarea id="jsonData"></textarea><br>
<label>GitHub Personal Access Token: </label>
<input type="password" id="token" placeholder="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"><br>
<button onclick="saveData()">حفظ على GitHub</button>

<script>
const owner = 'hassanalbraa';      // حسابك على GitHub
const repo = 'test';               // اسم الريبو الصحيح
const path = 'prices.json';        // اسم الملف
let sha = '';                      // SHA للملف

// تحميل JSON الحالي من GitHub
fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`)
  .then(res => res.json())
  .then(data => {
    sha = data.sha;
    const content = atob(data.content);
    document.getElementById('jsonData').value = content;
  })
  .catch(err => console.error("فشل تحميل الأسعار:", err));

function saveData(){
  const updated = document.getElementById('jsonData').value;
  const token = document.getElementById('token').value.trim();
  if(!token){ alert('ضع GitHub Token'); return; }

  try { JSON.parse(updated); } 
  catch(e){ alert("خطأ في JSON: " + e.message); return; }

  fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
    method: 'PUT',
    headers: {
      'Authorization': 'token ' + token,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: "تحديث الأسعار من صفحة الإدارة",
      content: btoa(updated),
      sha: sha
    })
  })
  .then(res => res.json())
  .then(data => {
    if(data.content){
      alert("تم حفظ التغييرات بنجاح! الأسعار تم تحديثها في الموقع الرئيسي.");
      sha = data.content.sha; // تحديث SHA بعد كل حفظ
    } else {
      console.error(data);
      alert("حدث خطأ عند الحفظ");
    }
  })
  .catch(err => console.error(err));
}
</script>
</body>
</html>
